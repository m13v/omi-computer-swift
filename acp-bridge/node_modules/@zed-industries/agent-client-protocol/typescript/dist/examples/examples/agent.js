#!/usr/bin/env node
import { AgentSideConnection, PROTOCOL_VERSION } from "../acp.js";
class MinimalAgent {
    async initialize(params) {
        console.error("[Agent] Initialize called with:", JSON.stringify(params, null, 2));
        return {
            protocolVersion: PROTOCOL_VERSION,
            agentCapabilities: {
                loadSession: false,
            },
        };
    }
    async newSession(params) {
        console.error("[Agent] New session called with:", JSON.stringify(params, null, 2));
        return {
            sessionId: "session-" + Math.random().toString(36).substring(7),
        };
    }
    async authenticate(params) {
        console.error("[Agent] Authenticate called with:", JSON.stringify(params, null, 2));
        // Authentication successful (no-op)
    }
    async prompt(params) {
        console.error("[Agent] Prompt called with:", JSON.stringify(params, null, 2));
        return {
            stopReason: "end_turn",
        };
    }
    async cancel(params) {
        console.error("[Agent] Cancel called with:", JSON.stringify(params, null, 2));
        // Cancel operation (no-op)
    }
}
// Create streams from process stdin/stdout
const input = new WritableStream({
    write(chunk) {
        process.stdout.write(chunk);
    },
});
const output = new ReadableStream({
    start(controller) {
        process.stdin.on("data", (chunk) => {
            controller.enqueue(new Uint8Array(chunk));
        });
        process.stdin.on("end", () => {
            controller.close();
        });
    },
});
// Create the agent connection
const connection = new AgentSideConnection((conn) => new MinimalAgent(), input, output);
console.error("[Agent] Started and waiting for connections...");
